<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixLife Store</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/headers/">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/css/headers.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="/assets/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/store.css" rel="stylesheet">
    <style>


    </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

      <div id="carouselExampleIndicators" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>

        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://placehold.co/1200x400" class="d-block w-100" alt="輪播圖1">
            </div>
            <div class="carousel-item">
                <img src="https://placehold.co/1200x400" class="d-block w-100" alt="輪播圖2">
            </div>
            <div class="carousel-item">
                <img src="https://placehold.co/1200x400" class="d-block w-100" alt="輪播圖3">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">上一張</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">下一張</span>
        </button>
    </div>


    <main>
<div class="product-grid">
    <!-- 如果商品列表為空，顯示提示信息 -->
    <div th:if="${products == null or products.isEmpty()}">
        <p th:text="${message ?: '目前沒有商品上架。'}">目前沒有商品上架。</p>
    </div>

    <!-- 商品列表 -->
    <a th:each="product : ${products}" 
       th:href="@{/store/productdetail/{id}(id=${product.prodNo})}" 
       class="product-card">
        <!-- 商品圖片 -->
        <div class="product-image" 
             th:style="${product.prodNo != null ? 'background-image: url(/store/image/' + product.prodNo + ');' : 'background-image: url(/static/img/default.png);'}">
             
    
<!-- 收藏按鈕 -->
<button class="favorite-btn"
        th:data-prod-id="${product.prodNo}"
        th:classappend="${collections != null && collections.?[prodNo == product.prodNo] != null} ? 'active' : ''"
        onclick="toggleFavorite(this)">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor">
        <path th:attr="d=${collections != null && collections.?[prodNo == product.prodNo] != null} ? 
                      'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'
                      : 'M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5c0-3.08-2.42-5.5-5.5-5.5z'" />
    </svg>
</button>




        
        </div>
        <!-- 商品資訊 -->
        <div class="product-info">
            <div class="product-title" th:text="${product.prodName ?: '未命名商品'}">商品名稱</div>
            <div class="product-price" th:text="'$' + (${product.price ?: 0})">商品價格</div>
        </div>
    </a>
</div>


        
<div class="pagination">
    
    <a th:if="${currentPage > 0}" 
       th:href="@{/store/products(page=${(currentPage ?: 0) - 1})}">上一頁</a>

    <!-- 當前頁 -->
    <span th:text="${(currentPage ?: 0) + 1}"></span> / 
    <span th:text="${totalPages ?: 1}"></span>

    
    <a th:if="${(currentPage ?: 0) + 1 < (totalPages ?: 1)}" 
       th:href="@{/store/products(page=${(currentPage ?: 0) + 1})}">下一頁</a>
</div>

    </main>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    function toggleFavorite(button) {
        const prodNo = button.getAttribute("data-prod-id");
        const isActive = button.classList.contains("active");

        const url = isActive 
            ? `/store/productcollection/remove/${prodNo}` 
            : `/store/productcollection/add/${prodNo}`;

        fetch(url, {
            method: isActive ? "DELETE" : "POST",
            headers: { "Content-Type": "application/json" }
        })
        .then(response => {
            if (response.status === 401) {
                alert("請先登入才能收藏商品！");
                window.location.href = "/login"; // 導向登入頁面
            } else if (response.ok) {
                button.classList.toggle("active"); // 切換按鈕樣式
                alert(isActive ? "已取消收藏" : "已加入收藏");
            } else {
                alert("操作失敗，請稍後再試！");
            }
        })
        .catch(() => alert("發生錯誤，請稍後再試！"));
    }
</script>
<script src="js/header.js"></script>

</body>
</html>
